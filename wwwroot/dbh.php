<?php
// dbh.php
require_once('db_config.php');

// DB?p???
// ----------------------------
function get_dbh() {
	//	?u??d????v??h?????????W?b?N
	static $dbh = NULL;
	if(NULL !== $dbh){
		return $dbh;
	}

    // ???l??ï
    $db_config = db_config();
    // ?f?[?^????
    $user = $db_config['user'];
    $pass = $db_config['pass'];
    $dsn = "mysql:dbname={$db_config['database']};host={$db_config['host']};charset={$db_config['charset']}";

    // ????I?v?V????????
    $opt = array (
        PDO::ATTR_EMULATE_PREPARES => false,
    );
    // ?u??????~?v????\???t???????????
    if (defined('PDO::MYSQL_ATTR_MULTI_STATEMENTS')) {
        $opt[PDO::MYSQL_ATTR_MULTI_STATEMENTS] = false;
    }

    // ???
    try {
        $dbh = new PDO($dsn, $user, $pass, $opt);
    } catch (PDOException $e) {
        // XXX ?{????????????J??G???[?y?[?W??o?????
        echo '?V?X?e????G???[???N???????';
        exit;
    }
    //
    return $dbh;
}
